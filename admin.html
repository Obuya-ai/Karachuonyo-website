<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Karachuonyo CDF</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }
        
        .login-form {
            background: white;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 400px;
        }
        
        .login-form h2 {
            text-align: center;
            margin-bottom: 30px;
            color: #333;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-weight: 500;
        }
        
        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .btn:hover {
            transform: translateY(-2px);
        }
        
        .admin-panel {
            display: none;
            min-height: 100vh;
            background: #f5f5f5;
        }
        
        .header {
            background: white;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header h1 {
            color: #333;
        }
        
        .logout-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .main-content {
            display: flex;
            min-height: calc(100vh - 80px);
        }
        
        .sidebar {
            width: 250px;
            background: white;
            padding: 20px;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
        }
        
        .nav-item {
            padding: 15px;
            margin-bottom: 10px;
            background: #f8f9fa;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .nav-item:hover {
            background: #e9ecef;
        }
        
        .nav-item.active {
            background: #667eea;
            color: white;
        }
        
        .content {
            flex: 1;
            padding: 20px;
        }
        
        .content-section {
            display: none;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .content-section.active {
            display: block;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        
        .add-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .table th,
        .table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        .table th {
            background: #f8f9fa;
            font-weight: 600;
        }
        
        .action-btn {
            padding: 5px 10px;
            margin: 0 2px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .edit-btn {
            background: #ffc107;
            color: #212529;
        }
        
        .delete-btn {
            background: #dc3545;
            color: white;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
        }
        
        .modal-content {
            background: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 10px;
            width: 90%;
            max-width: 600px;
            position: relative;
        }
        
        .close {
            position: absolute;
            right: 20px;
            top: 15px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-row .form-group {
            flex: 1;
        }
        
        textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            min-height: 100px;
            resize: vertical;
        }
        
        .alert {
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
        }
        
        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>
<body>
    <!-- Login Form -->
    <div id="loginContainer" class="login-container">
        <form id="loginForm" class="login-form">
            <h2>Admin Login</h2>
            <div class="form-group">
                <label for="username">Username:</label>
                <input type="text" id="username" name="username" required>
            </div>
            <div class="form-group">
                <label for="password">Password:</label>
                <input type="password" id="password" name="password" required>
            </div>
            <button type="submit" class="btn">Login</button>
            <div id="loginError" class="alert alert-error" style="display: none; margin-top: 20px;"></div>
        </form>
    </div>

    <!-- Admin Panel -->
    <div id="adminPanel" class="admin-panel">
        <header class="header">
            <h1>Karachuonyo CDF Admin Panel</h1>
            <button id="logoutBtn" class="logout-btn">Logout</button>
        </header>
        
        <div class="main-content">
            <nav class="sidebar">
                <div class="nav-item active" data-section="dashboard">Dashboard</div>
                <div class="nav-item" data-section="news">News Articles</div>
                <div class="nav-item" data-section="events">Events</div>
                <div class="nav-item" data-section="agenda">Agenda Items</div>
                <div class="nav-item" data-section="donations">Donations</div>
            </nav>
            
            <main class="content">
                <!-- Dashboard -->
                <section id="dashboard" class="content-section active">
                    <h2>Dashboard Overview</h2>
                    <div id="dashboardStats"></div>
                </section>
                
                <!-- News Articles -->
                <section id="news" class="content-section">
                    <div class="section-header">
                        <h2>News Articles</h2>
                        <button class="add-btn" onclick="openModal('newsModal')">Add Article</button>
                    </div>
                    <div id="newsAlert"></div>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Title</th>
                                <th>Date</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="newsTableBody"></tbody>
                    </table>
                </section>
                
                <!-- Events -->
                <section id="events" class="content-section">
                    <div class="section-header">
                        <h2>Events</h2>
                        <button class="add-btn" onclick="openModal('eventModal')">Add Event</button>
                    </div>
                    <div id="eventsAlert"></div>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Title</th>
                                <th>Date</th>
                                <th>Location</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="eventsTableBody"></tbody>
                    </table>
                </section>
                
                <!-- Agenda Items -->
                <section id="agenda" class="content-section">
                    <div class="section-header">
                        <h2>Agenda Items</h2>
                        <button class="add-btn" onclick="openModal('agendaModal')">Add Item</button>
                    </div>
                    <div id="agendaAlert"></div>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Title</th>
                                <th>Priority</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="agendaTableBody"></tbody>
                    </table>
                </section>
                
                <!-- Donations -->
                <section id="donations" class="content-section">
                    <h2>Donations</h2>
                    <div id="donationsAlert"></div>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Amount</th>
                                <th>Method</th>
                                <th>Date</th>
                            </tr>
                        </thead>
                        <tbody id="donationsTableBody"></tbody>
                    </table>
                </section>
            </main>
        </div>
    </div>

    <!-- Modals -->
    <!-- News Modal -->
    <div id="newsModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('newsModal')">&times;</span>
            <h3 id="newsModalTitle">Add News Article</h3>
            <form id="newsForm">
                <div class="form-group">
                    <label for="newsTitle">Title:</label>
                    <input type="text" id="newsTitle" name="title" required>
                </div>
                <div class="form-group">
                    <label for="newsContent">Content:</label>
                    <textarea id="newsContent" name="content" required></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="newsAuthor">Author:</label>
                        <input type="text" id="newsAuthor" name="author" required>
                    </div>
                    <div class="form-group">
                        <label for="newsCategory">Category:</label>
                        <input type="text" id="newsCategory" name="category">
                    </div>
                </div>
                <button type="submit" class="btn">Save Article</button>
            </form>
        </div>
    </div>

    <!-- Event Modal -->
    <div id="eventModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('eventModal')">&times;</span>
            <h3 id="eventModalTitle">Add Event</h3>
            <form id="eventForm">
                <div class="form-group">
                    <label for="eventTitle">Title:</label>
                    <input type="text" id="eventTitle" name="title" required>
                </div>
                <div class="form-group">
                    <label for="eventDescription">Description:</label>
                    <textarea id="eventDescription" name="description" required></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="eventDate">Date:</label>
                        <input type="datetime-local" id="eventDate" name="date" required>
                    </div>
                    <div class="form-group">
                        <label for="eventLocation">Location:</label>
                        <input type="text" id="eventLocation" name="location" required>
                    </div>
                </div>
                <button type="submit" class="btn">Save Event</button>
            </form>
        </div>
    </div>

    <!-- Agenda Modal -->
    <div id="agendaModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('agendaModal')">&times;</span>
            <h3 id="agendaModalTitle">Add Agenda Item</h3>
            <form id="agendaForm">
                <div class="form-group">
                    <label for="agendaTitle">Title:</label>
                    <input type="text" id="agendaTitle" name="title" required>
                </div>
                <div class="form-group">
                    <label for="agendaDescription">Description:</label>
                    <textarea id="agendaDescription" name="description" required></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="agendaPriority">Priority:</label>
                        <select id="agendaPriority" name="priority" required>
                            <option value="high">High</option>
                            <option value="medium">Medium</option>
                            <option value="low">Low</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="agendaStatus">Status:</label>
                        <select id="agendaStatus" name="status" required>
                            <option value="pending">Pending</option>
                            <option value="in_progress">In Progress</option>
                            <option value="completed">Completed</option>
                        </select>
                    </div>
                </div>
                <button type="submit" class="btn">Save Item</button>
            </form>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:5000';
        let authToken = localStorage.getItem('adminToken');
        let currentEditId = null;
        
        // Check if already logged in
        if (authToken) {
            showAdminPanel();
            loadDashboard();
        }
        
        // Login form handler
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const credentials = {
                username: formData.get('username'),
                password: formData.get('password')
            };
            
            try {
                const response = await fetch(`${API_BASE}/admin/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(credentials)
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    authToken = data.token;
                    localStorage.setItem('adminToken', authToken);
                    showAdminPanel();
                    loadDashboard();
                } else {
                    showError('loginError', data.error || 'Login failed');
                }
            } catch (error) {
                showError('loginError', 'Connection error. Please try again.');
            }
        });
        
        // Logout handler
        document.getElementById('logoutBtn').addEventListener('click', () => {
            localStorage.removeItem('adminToken');
            authToken = null;
            showLoginForm();
        });
        
        // Navigation handler
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', () => {
                const section = item.dataset.section;
                switchSection(section);
                
                // Load section data
                switch(section) {
                    case 'dashboard':
                        loadDashboard();
                        break;
                    case 'news':
                        loadNews();
                        break;
                    case 'events':
                        loadEvents();
                        break;
                    case 'agenda':
                        loadAgenda();
                        break;
                    case 'donations':
                        loadDonations();
                        break;
                }
            });
        });
        
        // Form handlers
        document.getElementById('newsForm').addEventListener('submit', handleNewsSubmit);
        document.getElementById('eventForm').addEventListener('submit', handleEventSubmit);
        document.getElementById('agendaForm').addEventListener('submit', handleAgendaSubmit);
        
        function showAdminPanel() {
            document.getElementById('loginContainer').style.display = 'none';
            document.getElementById('adminPanel').style.display = 'block';
        }
        
        function showLoginForm() {
            document.getElementById('loginContainer').style.display = 'flex';
            document.getElementById('adminPanel').style.display = 'none';
        }
        
        function switchSection(sectionName) {
            // Update navigation
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector(`[data-section="${sectionName}"]`).classList.add('active');
            
            // Update content
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(sectionName).classList.add('active');
        }
        
        function openModal(modalId, editData = null) {
            document.getElementById(modalId).style.display = 'block';
            
            if (editData) {
                currentEditId = editData.id;
                // Populate form with edit data
                if (modalId === 'newsModal') {
                    document.getElementById('newsModalTitle').textContent = 'Edit News Article';
                    document.getElementById('newsTitle').value = editData.title;
                    document.getElementById('newsContent').value = editData.content;
                    document.getElementById('newsAuthor').value = editData.author;
                    document.getElementById('newsCategory').value = editData.category || '';
                } else if (modalId === 'eventModal') {
                    document.getElementById('eventModalTitle').textContent = 'Edit Event';
                    document.getElementById('eventTitle').value = editData.title;
                    document.getElementById('eventDescription').value = editData.description;
                    document.getElementById('eventDate').value = editData.date;
                    document.getElementById('eventLocation').value = editData.location;
                } else if (modalId === 'agendaModal') {
                    document.getElementById('agendaModalTitle').textContent = 'Edit Agenda Item';
                    document.getElementById('agendaTitle').value = editData.title;
                    document.getElementById('agendaDescription').value = editData.description;
                    document.getElementById('agendaPriority').value = editData.priority;
                    document.getElementById('agendaStatus').value = editData.status;
                }
            } else {
                currentEditId = null;
                // Reset form titles
                if (modalId === 'newsModal') {
                    document.getElementById('newsModalTitle').textContent = 'Add News Article';
                } else if (modalId === 'eventModal') {
                    document.getElementById('eventModalTitle').textContent = 'Add Event';
                } else if (modalId === 'agendaModal') {
                    document.getElementById('agendaModalTitle').textContent = 'Add Agenda Item';
                }
            }
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
            // Reset forms
            document.querySelector(`#${modalId} form`).reset();
            currentEditId = null;
        }
        
        async function loadDashboard() {
            try {
                const [newsRes, eventsRes, donationsRes] = await Promise.all([
                    fetch(`${API_BASE}/admin/news`, { headers: { 'Authorization': `Bearer ${authToken}` } }),
                    fetch(`${API_BASE}/admin/events`, { headers: { 'Authorization': `Bearer ${authToken}` } }),
                    fetch(`${API_BASE}/admin/donations`, { headers: { 'Authorization': `Bearer ${authToken}` } })
                ]);
                
                const news = await newsRes.json();
                const events = await eventsRes.json();
                const donations = await donationsRes.json();
                
                document.getElementById('dashboardStats').innerHTML = `
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 20px;">
                        <div style="background: #fff; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); text-align: center;">
                            <h3 style="color: #667eea;">${news.length}</h3>
                            <p>News Articles</p>
                        </div>
                        <div style="background: #fff; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); text-align: center;">
                            <h3 style="color: #28a745;">${events.length}</h3>
                            <p>Events</p>
                        </div>
                        <div style="background: #fff; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); text-align: center;">
                            <h3 style="color: #ffc107;">${donations.length}</h3>
                            <p>Donations</p>
                        </div>
                    </div>
                `;
            } catch (error) {
                console.error('Error loading dashboard:', error);
            }
        }
        
        async function loadNews() {
            try {
                const response = await fetch(`${API_BASE}/admin/news`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                const news = await response.json();
                
                const tbody = document.getElementById('newsTableBody');
                tbody.innerHTML = news.map(article => `
                    <tr>
                        <td>${article.title}</td>
                        <td>${new Date(article.created_at).toLocaleDateString()}</td>
                        <td><span style="padding: 4px 8px; background: #28a745; color: white; border-radius: 4px; font-size: 12px;">Published</span></td>
                        <td>
                            <button class="action-btn edit-btn" onclick="editNews(${article.id})">Edit</button>
                            <button class="action-btn delete-btn" onclick="deleteNews(${article.id})">Delete</button>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                showAlert('newsAlert', 'Error loading news articles', 'error');
            }
        }
        
        async function loadEvents() {
            try {
                const response = await fetch(`${API_BASE}/admin/events`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                const events = await response.json();
                
                const tbody = document.getElementById('eventsTableBody');
                tbody.innerHTML = events.map(event => `
                    <tr>
                        <td>${event.title}</td>
                        <td>${new Date(event.date).toLocaleDateString()}</td>
                        <td>${event.location}</td>
                        <td>
                            <button class="action-btn edit-btn" onclick="editEvent(${event.id})">Edit</button>
                            <button class="action-btn delete-btn" onclick="deleteEvent(${event.id})">Delete</button>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                showAlert('eventsAlert', 'Error loading events', 'error');
            }
        }
        
        async function loadAgenda() {
            try {
                const response = await fetch(`${API_BASE}/admin/agenda`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                const agenda = await response.json();
                
                const tbody = document.getElementById('agendaTableBody');
                tbody.innerHTML = agenda.map(item => `
                    <tr>
                        <td>${item.title}</td>
                        <td><span style="padding: 4px 8px; background: ${item.priority === 'high' ? '#dc3545' : item.priority === 'medium' ? '#ffc107' : '#28a745'}; color: white; border-radius: 4px; font-size: 12px;">${item.priority}</span></td>
                        <td><span style="padding: 4px 8px; background: ${item.status === 'completed' ? '#28a745' : item.status === 'in_progress' ? '#ffc107' : '#6c757d'}; color: white; border-radius: 4px; font-size: 12px;">${item.status}</span></td>
                        <td>
                            <button class="action-btn edit-btn" onclick="editAgenda(${item.id})">Edit</button>
                            <button class="action-btn delete-btn" onclick="deleteAgenda(${item.id})">Delete</button>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                showAlert('agendaAlert', 'Error loading agenda items', 'error');
            }
        }
        
        async function loadDonations() {
            try {
                const response = await fetch(`${API_BASE}/admin/donations`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                const donations = await response.json();
                
                const tbody = document.getElementById('donationsTableBody');
                tbody.innerHTML = donations.map(donation => `
                    <tr>
                        <td>${donation.name}</td>
                        <td>${donation.email}</td>
                        <td>$${donation.amount}</td>
                        <td>${donation.payment_method}</td>
                        <td>${new Date(donation.created_at).toLocaleDateString()}</td>
                    </tr>
                `).join('');
            } catch (error) {
                showAlert('donationsAlert', 'Error loading donations', 'error');
            }
        }
        
        async function handleNewsSubmit(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const newsData = {
                title: formData.get('title'),
                content: formData.get('content'),
                author: formData.get('author'),
                category: formData.get('category')
            };
            
            try {
                const url = currentEditId ? `${API_BASE}/admin/news/${currentEditId}` : `${API_BASE}/admin/news`;
                const method = currentEditId ? 'PUT' : 'POST';
                
                const response = await fetch(url, {
                    method,
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify(newsData)
                });
                
                if (response.ok) {
                    closeModal('newsModal');
                    loadNews();
                    showAlert('newsAlert', `Article ${currentEditId ? 'updated' : 'created'} successfully!`, 'success');
                } else {
                    const error = await response.json();
                    showAlert('newsAlert', error.error || 'Operation failed', 'error');
                }
            } catch (error) {
                showAlert('newsAlert', 'Connection error', 'error');
            }
        }
        
        async function handleEventSubmit(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const eventData = {
                title: formData.get('title'),
                description: formData.get('description'),
                date: formData.get('date'),
                location: formData.get('location')
            };
            
            try {
                const url = currentEditId ? `${API_BASE}/admin/events/${currentEditId}` : `${API_BASE}/admin/events`;
                const method = currentEditId ? 'PUT' : 'POST';
                
                const response = await fetch(url, {
                    method,
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify(eventData)
                });
                
                if (response.ok) {
                    closeModal('eventModal');
                    loadEvents();
                    showAlert('eventsAlert', `Event ${currentEditId ? 'updated' : 'created'} successfully!`, 'success');
                } else {
                    const error = await response.json();
                    showAlert('eventsAlert', error.error || 'Operation failed', 'error');
                }
            } catch (error) {
                showAlert('eventsAlert', 'Connection error', 'error');
            }
        }
        
        async function handleAgendaSubmit(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const agendaData = {
                title: formData.get('title'),
                description: formData.get('description'),
                priority: formData.get('priority'),
                status: formData.get('status')
            };
            
            try {
                const url = currentEditId ? `${API_BASE}/admin/agenda/${currentEditId}` : `${API_BASE}/admin/agenda`;
                const method = currentEditId ? 'PUT' : 'POST';
                
                const response = await fetch(url, {
                    method,
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify(agendaData)
                });
                
                if (response.ok) {
                    closeModal('agendaModal');
                    loadAgenda();
                    showAlert('agendaAlert', `Agenda item ${currentEditId ? 'updated' : 'created'} successfully!`, 'success');
                } else {
                    const error = await response.json();
                    showAlert('agendaAlert', error.error || 'Operation failed', 'error');
                }
            } catch (error) {
                showAlert('agendaAlert', 'Connection error', 'error');
            }
        }
        
        async function editNews(id) {
            try {
                const response = await fetch(`${API_BASE}/admin/news/${id}`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                const article = await response.json();
                openModal('newsModal', article);
            } catch (error) {
                showAlert('newsAlert', 'Error loading article', 'error');
            }
        }
        
        async function deleteNews(id) {
            if (confirm('Are you sure you want to delete this article?')) {
                try {
                    const response = await fetch(`${API_BASE}/admin/news/${id}`, {
                        method: 'DELETE',
                        headers: { 'Authorization': `Bearer ${authToken}` }
                    });
                    
                    if (response.ok) {
                        loadNews();
                        showAlert('newsAlert', 'Article deleted successfully!', 'success');
                    } else {
                        showAlert('newsAlert', 'Error deleting article', 'error');
                    }
                } catch (error) {
                    showAlert('newsAlert', 'Connection error', 'error');
                }
            }
        }
        
        async function editEvent(id) {
            try {
                const response = await fetch(`${API_BASE}/admin/events/${id}`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                const event = await response.json();
                openModal('eventModal', event);
            } catch (error) {
                showAlert('eventsAlert', 'Error loading event', 'error');
            }
        }
        
        async function deleteEvent(id) {
            if (confirm('Are you sure you want to delete this event?')) {
                try {
                    const response = await fetch(`${API_BASE}/admin/events/${id}`, {
                        method: 'DELETE',
                        headers: { 'Authorization': `Bearer ${authToken}` }
                    });
                    
                    if (response.ok) {
                        loadEvents();
                        showAlert('eventsAlert', 'Event deleted successfully!', 'success');
                    } else {
                        showAlert('eventsAlert', 'Error deleting event', 'error');
                    }
                } catch (error) {
                    showAlert('eventsAlert', 'Connection error', 'error');
                }
            }
        }
        
        async function editAgenda(id) {
            try {
                const response = await fetch(`${API_BASE}/admin/agenda/${id}`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                const item = await response.json();
                openModal('agendaModal', item);
            } catch (error) {
                showAlert('agendaAlert', 'Error loading agenda item', 'error');
            }
        }
        
        async function deleteAgenda(id) {
            if (confirm('Are you sure you want to delete this agenda item?')) {
                try {
                    const response = await fetch(`${API_BASE}/admin/agenda/${id}`, {
                        method: 'DELETE',
                        headers: { 'Authorization': `Bearer ${authToken}` }
                    });
                    
                    if (response.ok) {
                        loadAgenda();
                        showAlert('agendaAlert', 'Agenda item deleted successfully!', 'success');
                    } else {
                        showAlert('agendaAlert', 'Error deleting agenda item', 'error');
                    }
                } catch (error) {
                    showAlert('agendaAlert', 'Connection error', 'error');
                }
            }
        }
        
        function showAlert(containerId, message, type) {
            const container = document.getElementById(containerId);
            container.innerHTML = `<div class="alert alert-${type === 'error' ? 'error' : 'success'}">${message}</div>`;
            setTimeout(() => {
                container.innerHTML = '';
            }, 5000);
        }
        
        function showError(elementId, message) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.style.display = 'block';
        }
        
        // Close modals when clicking outside
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        }
    </script>
</body>
</html>