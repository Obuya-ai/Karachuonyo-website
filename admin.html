<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Karachuonyo CDF</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary-color: #2563eb;
            --primary-dark: #1d4ed8;
            --secondary-color: #64748b;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --background-color: #f8fafc;
            --surface-color: #ffffff;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --border-color: #e2e8f0;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            --radius-sm: 0.375rem;
            --radius-md: 0.5rem;
            --radius-lg: 0.75rem;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--background-color);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
        }
        
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 1.5rem;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
        }
        
        .login-form {
            background: var(--surface-color);
            padding: 2.5rem;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            width: 100%;
            max-width: 28rem;
            border: 1px solid var(--border-color);
        }
        
        .login-form h2 {
            text-align: center;
            margin-bottom: 2rem;
            color: var(--text-primary);
            font-size: 1.875rem;
            font-weight: 700;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
            font-weight: 500;
            font-size: 0.875rem;
        }
        
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            font-size: 1rem;
            transition: all 0.2s ease;
            background-color: var(--surface-color);
        }
        
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgb(37 99 235 / 0.1);
        }
        
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.75rem 1.5rem;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: var(--radius-md);
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
        }
        
        .btn:hover {
            background-color: var(--primary-dark);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn-full {
            width: 100%;
        }
        
        .admin-panel {
            display: none;
            min-height: 100vh;
            background-color: var(--background-color);
        }
        
        .header {
            background-color: var(--surface-color);
            padding: 1.5rem 2rem;
            box-shadow: var(--shadow-sm);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 50;
        }
        
        .header h1 {
            color: var(--text-primary);
            font-size: 1.5rem;
            font-weight: 700;
        }
        
        .logout-btn {
            background-color: var(--danger-color);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: var(--radius-md);
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.2s ease;
        }
        
        .logout-btn:hover {
            background-color: #dc2626;
            transform: translateY(-1px);
        }
        
        .main-content {
            display: flex;
            min-height: calc(100vh - 5rem);
        }
        
        .sidebar {
            width: 16rem;
            background-color: var(--surface-color);
            padding: 1.5rem;
            border-right: 1px solid var(--border-color);
            overflow-y: auto;
        }
        
        .nav-item {
            padding: 0.75rem 1rem;
            margin-bottom: 0.5rem;
            background-color: transparent;
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 500;
            color: var(--text-secondary);
            border: 1px solid transparent;
        }
        
        .nav-item:hover {
            background-color: var(--background-color);
            color: var(--text-primary);
        }
        
        .nav-item.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                border-right: none;
                border-bottom: 1px solid var(--border-color);
                padding: 1rem;
            }
            
            .nav-item {
                display: inline-block;
                margin-right: 0.5rem;
                margin-bottom: 0.5rem;
            }
        }
        
        .content {
            flex: 1;
            padding: 1.5rem;
            overflow-y: auto;
        }
        
        .content-section {
            display: none;
            background-color: var(--surface-color);
            padding: 2rem;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
        }
        
        .content-section.active {
            display: block;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .section-header h2 {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
        }
        
        .add-btn {
            background-color: var(--success-color);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: var(--radius-md);
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.2s ease;
        }
        
        .add-btn:hover {
            background-color: #059669;
            transform: translateY(-1px);
        }
        
        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
            background-color: var(--surface-color);
            border-radius: var(--radius-md);
            overflow: hidden;
            box-shadow: var(--shadow-sm);
        }
        
        .table th,
        .table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }
        
        .table th {
            background-color: var(--background-color);
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .table td {
            color: var(--text-secondary);
        }
        
        .table tbody tr:hover {
            background-color: var(--background-color);
        }
        
        .action-btn {
            padding: 0.375rem 0.75rem;
            margin: 0 0.25rem;
            border: none;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-size: 0.75rem;
            font-weight: 500;
            transition: all 0.2s ease;
        }
        
        .edit-btn {
            background-color: var(--warning-color);
            color: white;
        }
        
        .edit-btn:hover {
            background-color: #d97706;
            transform: translateY(-1px);
        }
        
        .delete-btn {
            background-color: var(--danger-color);
            color: white;
        }
        
        .delete-btn:hover {
            background-color: #dc2626;
            transform: translateY(-1px);
        }
        
        .reply-btn {
            background-color: var(--primary-color);
            color: white;
        }
        
        .reply-btn:hover {
            background-color: var(--primary-dark);
            transform: translateY(-1px);
        }
        
        @media (max-width: 768px) {
            .table {
                font-size: 0.875rem;
            }
            
            .table th,
            .table td {
                padding: 0.75rem 0.5rem;
            }
            
            .action-btn {
                padding: 0.25rem 0.5rem;
                font-size: 0.625rem;
            }
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
        }
        
        .modal-content {
            background-color: var(--surface-color);
            margin: 2rem auto;
            padding: 2rem;
            border-radius: var(--radius-lg);
            width: 90%;
            max-width: 42rem;
            position: relative;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border-color);
            max-height: calc(100vh - 4rem);
            overflow-y: auto;
        }
        
        .modal-content h3 {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 1.5rem;
        }
        
        .close {
            position: absolute;
            right: 1.5rem;
            top: 1rem;
            font-size: 1.5rem;
            font-weight: bold;
            cursor: pointer;
            color: var(--text-secondary);
            transition: color 0.2s ease;
        }
        
        .close:hover {
            color: var(--text-primary);
        }
        
        @media (max-width: 768px) {
            .modal-content {
                margin: 1rem;
                width: calc(100% - 2rem);
                padding: 1.5rem;
            }
        }
        
        .form-row {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .form-row .form-group {
            flex: 1;
        }
        
        textarea {
            min-height: 6rem;
            resize: vertical;
            font-family: inherit;
        }
        
        .alert {
            padding: 1rem;
            margin-bottom: 1.5rem;
            border-radius: var(--radius-md);
            border: 1px solid;
            font-weight: 500;
        }
        
        .alert-success {
            background-color: #dcfce7;
            color: #166534;
            border-color: #bbf7d0;
        }
        
        .alert-error {
            background-color: #fef2f2;
            color: #991b1b;
            border-color: #fecaca;
        }
        
        .alert-info {
            background-color: #dbeafe;
            color: #1e40af;
            border-color: #bfdbfe;
        }
        
        .loading {
            opacity: 0.6;
            pointer-events: none;
        }
        
        .loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 1rem;
            height: 1rem;
            margin: -0.5rem 0 0 -0.5rem;
            border: 2px solid var(--primary-color);
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
        
        /* Message Status Styles */
        .status-read {
            color: var(--success-color);
            font-weight: 500;
        }
        
        .status-unread {
            color: var(--warning-color);
            font-weight: 600;
        }
        
        .status-new {
            color: var(--primary-color);
            font-weight: 600;
        }
        
        @media (max-width: 640px) {
            .form-row {
                flex-direction: column;
                gap: 0;
            }
            
            .header {
                padding: 1rem;
            }
            
            .header h1 {
                font-size: 1.25rem;
            }
            
            .content {
                padding: 1rem;
            }
            
            .content-section {
                padding: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- Login Form -->
    <div id="loginContainer" class="login-container">
        <form id="loginForm" class="login-form">
            <h2>Admin Login</h2>
            <div class="form-group">
                <label for="username">Username:</label>
                <input type="text" id="username" name="username" required>
            </div>
            <div class="form-group">
                <label for="password">Password:</label>
                <input type="password" id="password" name="password" required>
            </div>
            <button type="submit" class="btn">Login</button>
            <div id="loginError" class="alert alert-error" style="display: none; margin-top: 20px;"></div>
        </form>
    </div>

    <!-- Admin Panel -->
    <div id="adminPanel" class="admin-panel">
        <header class="header">
            <h1>Karachuonyo CDF Admin Panel</h1>
            <button id="logoutBtn" class="logout-btn">Logout</button>
        </header>
        
        <div class="main-content">
            <nav class="sidebar">
                <div class="nav-item active" data-section="dashboard">Dashboard</div>
                <div class="nav-item" data-section="news">News Articles</div>
                <div class="nav-item" data-section="events">Events</div>
                <div class="nav-item" data-section="agenda">Agenda Items</div>
                <div class="nav-item" data-section="messages">Contact Messages</div>
                <div class="nav-item" data-section="donations">Donations</div>
            </nav>
            
            <main class="content">
                <!-- Dashboard -->
                <section id="dashboard" class="content-section active">
                    <h2>Dashboard Overview</h2>
                    <div id="dashboardStats"></div>
                </section>
                
                <!-- News Articles -->
                <section id="news" class="content-section">
                    <div class="section-header">
                        <h2>News Articles</h2>
                        <button class="add-btn" onclick="openModal('newsModal')">Add Article</button>
                    </div>
                    <div id="newsAlert"></div>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Title</th>
                                <th>Date</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="newsTableBody"></tbody>
                    </table>
                </section>
                
                <!-- Events -->
                <section id="events" class="content-section">
                    <div class="section-header">
                        <h2>Events</h2>
                        <button class="add-btn" onclick="openModal('eventModal')">Add Event</button>
                    </div>
                    <div id="eventsAlert"></div>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Title</th>
                                <th>Date</th>
                                <th>Location</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="eventsTableBody"></tbody>
                    </table>
                </section>
                
                <!-- Agenda Items -->
                <section id="agenda" class="content-section">
                    <div class="section-header">
                        <h2>Agenda Items</h2>
                        <button class="add-btn" onclick="openModal('agendaModal')">Add Item</button>
                    </div>
                    <div id="agendaAlert"></div>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Title</th>
                                <th>Priority</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="agendaTableBody"></tbody>
                    </table>
                </section>
                
                <!-- Contact Messages -->
                <section id="messages" class="content-section">
                    <div class="section-header">
                        <h2>Contact Messages</h2>
                        <div>
                            <button class="btn" onclick="loadMessages()" style="margin-right: 0.5rem;">Refresh</button>
                            <select id="messageFilter" onchange="filterMessages()" style="padding: 0.5rem; border-radius: var(--radius-md); border: 1px solid var(--border-color);">
                                <option value="all">All Messages</option>
                                <option value="unread">Unread</option>
                                <option value="read">Read</option>
                                <option value="replied">Replied</option>
                            </select>
                        </div>
                    </div>
                    <div id="messagesAlert"></div>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Subject</th>
                                <th>Date</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="messagesTableBody"></tbody>
                    </table>
                </section>
                
                <!-- Donations -->
                <section id="donations" class="content-section">
                    <h2>Donations</h2>
                    <div id="donationsAlert"></div>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Amount</th>
                                <th>Method</th>
                                <th>Date</th>
                            </tr>
                        </thead>
                        <tbody id="donationsTableBody"></tbody>
                    </table>
                </section>
            </main>
        </div>
    </div>

    <!-- Modals -->
    <!-- News Modal -->
    <div id="newsModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('newsModal')">&times;</span>
            <h3 id="newsModalTitle">Add News Article</h3>
            <form id="newsForm">
                <div class="form-group">
                    <label for="newsTitle">Title:</label>
                    <input type="text" id="newsTitle" name="title" required>
                </div>
                <div class="form-group">
                    <label for="newsContent">Content:</label>
                    <textarea id="newsContent" name="content" required></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="newsAuthor">Author:</label>
                        <input type="text" id="newsAuthor" name="author" required>
                    </div>
                    <div class="form-group">
                        <label for="newsCategory">Category:</label>
                        <input type="text" id="newsCategory" name="category">
                    </div>
                </div>
                <button type="submit" class="btn">Save Article</button>
            </form>
        </div>
    </div>

    <!-- Event Modal -->
    <div id="eventModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('eventModal')">&times;</span>
            <h3 id="eventModalTitle">Add Event</h3>
            <form id="eventForm">
                <div class="form-group">
                    <label for="eventTitle">Title:</label>
                    <input type="text" id="eventTitle" name="title" required>
                </div>
                <div class="form-group">
                    <label for="eventDescription">Description:</label>
                    <textarea id="eventDescription" name="description" required></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="eventDate">Date:</label>
                        <input type="datetime-local" id="eventDate" name="date" required>
                    </div>
                    <div class="form-group">
                        <label for="eventLocation">Location:</label>
                        <input type="text" id="eventLocation" name="location" required>
                    </div>
                </div>
                <button type="submit" class="btn">Save Event</button>
            </form>
        </div>
    </div>

    <!-- Agenda Modal -->
    <div id="agendaModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('agendaModal')">&times;</span>
            <h3 id="agendaModalTitle">Add Agenda Item</h3>
            <form id="agendaForm">
                <div class="form-group">
                    <label for="agendaTitle">Title:</label>
                    <input type="text" id="agendaTitle" name="title" required>
                </div>
                <div class="form-group">
                    <label for="agendaDescription">Description:</label>
                    <textarea id="agendaDescription" name="description" required></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="agendaPriority">Priority:</label>
                        <select id="agendaPriority" name="priority" required>
                            <option value="high">High</option>
                            <option value="medium">Medium</option>
                            <option value="low">Low</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="agendaStatus">Status:</label>
                        <select id="agendaStatus" name="status" required>
                            <option value="pending">Pending</option>
                            <option value="in_progress">In Progress</option>
                            <option value="completed">Completed</option>
                        </select>
                    </div>
                </div>
                <button type="submit" class="btn">Save Item</button>
            </form>
        </div>
    </div>

    <script>
        const API_BASE = 'https://karachuonyo-backend.onrender.com';
        let authToken = localStorage.getItem('adminToken');
        let currentEditId = null;
        
        // Check if already logged in
        if (authToken) {
            showAdminPanel();
            loadDashboard();
        }
        
        // Login form handler
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const credentials = {
                username: formData.get('username'),
                password: formData.get('password')
            };
            
            try {
                const response = await fetch(`${API_BASE}/api/admin/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(credentials)
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    authToken = data.token;
                    localStorage.setItem('adminToken', authToken);
                    showAdminPanel();
                    loadDashboard();
                } else {
                    showError('loginError', data.error || 'Login failed');
                }
            } catch (error) {
                showError('loginError', 'Connection error. Please try again.');
            }
        });
        
        // Logout handler
        document.getElementById('logoutBtn').addEventListener('click', () => {
            localStorage.removeItem('adminToken');
            authToken = null;
            showLoginForm();
        });
        
        // Navigation handler
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', () => {
                const section = item.dataset.section;
                switchSection(section);
                
                // Load section data
                switch(section) {
                    case 'dashboard':
                        loadDashboard();
                        break;
                    case 'news':
                        loadNews();
                        break;
                    case 'events':
                        loadEvents();
                        break;
                    case 'agenda':
                        loadAgenda();
                        break;
                    case 'messages':
                        loadMessages();
                        break;
                    case 'donations':
                        loadDonations();
                        break;
                }
            });
        });
        
        // Form handlers
        document.getElementById('newsForm').addEventListener('submit', handleNewsSubmit);
        document.getElementById('eventForm').addEventListener('submit', handleEventSubmit);
        document.getElementById('agendaForm').addEventListener('submit', handleAgendaSubmit);
        
        function showAdminPanel() {
            document.getElementById('loginContainer').style.display = 'none';
            document.getElementById('adminPanel').style.display = 'block';
        }
        
        function showLoginForm() {
            document.getElementById('loginContainer').style.display = 'flex';
            document.getElementById('adminPanel').style.display = 'none';
        }
        
        function switchSection(sectionName) {
            // Update navigation
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector(`[data-section="${sectionName}"]`).classList.add('active');
            
            // Update content
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(sectionName).classList.add('active');
        }
        
        function openModal(modalId, editData = null) {
            document.getElementById(modalId).style.display = 'block';
            
            if (editData) {
                currentEditId = editData.id;
                // Populate form with edit data
                if (modalId === 'newsModal') {
                    document.getElementById('newsModalTitle').textContent = 'Edit News Article';
                    document.getElementById('newsTitle').value = editData.title;
                    document.getElementById('newsContent').value = editData.content;
                    document.getElementById('newsAuthor').value = editData.author;
                    document.getElementById('newsCategory').value = editData.category || '';
                } else if (modalId === 'eventModal') {
                    document.getElementById('eventModalTitle').textContent = 'Edit Event';
                    document.getElementById('eventTitle').value = editData.title;
                    document.getElementById('eventDescription').value = editData.description;
                    document.getElementById('eventDate').value = editData.date;
                    document.getElementById('eventLocation').value = editData.location;
                } else if (modalId === 'agendaModal') {
                    document.getElementById('agendaModalTitle').textContent = 'Edit Agenda Item';
                    document.getElementById('agendaTitle').value = editData.title;
                    document.getElementById('agendaDescription').value = editData.description;
                    document.getElementById('agendaPriority').value = editData.priority;
                    document.getElementById('agendaStatus').value = editData.status;
                }
            } else {
                currentEditId = null;
                // Reset form titles
                if (modalId === 'newsModal') {
                    document.getElementById('newsModalTitle').textContent = 'Add News Article';
                } else if (modalId === 'eventModal') {
                    document.getElementById('eventModalTitle').textContent = 'Add Event';
                } else if (modalId === 'agendaModal') {
                    document.getElementById('agendaModalTitle').textContent = 'Add Agenda Item';
                }
            }
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
            // Reset forms
            document.querySelector(`#${modalId} form`).reset();
            currentEditId = null;
        }
        
        async function loadDashboard() {
            try {
                const [newsRes, eventsRes, donationsRes] = await Promise.all([
                    fetch(`${API_BASE}/api/admin/news`, { headers: { 'Authorization': `Bearer ${authToken}` } }),
            fetch(`${API_BASE}/api/admin/events`, { headers: { 'Authorization': `Bearer ${authToken}` } }),
            fetch(`${API_BASE}/api/admin/donations`, { headers: { 'Authorization': `Bearer ${authToken}` } })
                ]);
                
                const news = await newsRes.json();
                const events = await eventsRes.json();
                const donations = await donationsRes.json();
                
                document.getElementById('dashboardStats').innerHTML = `
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 20px;">
                        <div style="background: #fff; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); text-align: center;">
                            <h3 style="color: #667eea;">${news.length}</h3>
                            <p>News Articles</p>
                        </div>
                        <div style="background: #fff; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); text-align: center;">
                            <h3 style="color: #28a745;">${events.length}</h3>
                            <p>Events</p>
                        </div>
                        <div style="background: #fff; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); text-align: center;">
                            <h3 style="color: #ffc107;">${donations.length}</h3>
                            <p>Donations</p>
                        </div>
                    </div>
                `;
            } catch (error) {
                console.error('Error loading dashboard:', error);
            }
        }
        
        async function loadNews() {
            try {
                const response = await fetch(`${API_BASE}/api/admin/news`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                const news = await response.json();
                
                const tbody = document.getElementById('newsTableBody');
                tbody.innerHTML = news.map(article => `
                    <tr>
                        <td>${article.title}</td>
                        <td>${new Date(article.created_at).toLocaleDateString()}</td>
                        <td><span style="padding: 4px 8px; background: #28a745; color: white; border-radius: 4px; font-size: 12px;">Published</span></td>
                        <td>
                            <button class="action-btn edit-btn" onclick="editNews(${article.id})">Edit</button>
                            <button class="action-btn delete-btn" onclick="deleteNews(${article.id})">Delete</button>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                showAlert('newsAlert', 'Error loading news articles', 'error');
            }
        }
        
        async function loadEvents() {
            try {
                const response = await fetch(`${API_BASE}/api/admin/events`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                const events = await response.json();
                
                const tbody = document.getElementById('eventsTableBody');
                tbody.innerHTML = events.map(event => `
                    <tr>
                        <td>${event.title}</td>
                        <td>${new Date(event.date).toLocaleDateString()}</td>
                        <td>${event.location}</td>
                        <td>
                            <button class="action-btn edit-btn" onclick="editEvent(${event.id})">Edit</button>
                            <button class="action-btn delete-btn" onclick="deleteEvent(${event.id})">Delete</button>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                showAlert('eventsAlert', 'Error loading events', 'error');
            }
        }
        
        async function loadAgenda() {
            try {
                const response = await fetch(`${API_BASE}/api/admin/agenda`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                const agenda = await response.json();
                
                const tbody = document.getElementById('agendaTableBody');
                tbody.innerHTML = agenda.map(item => `
                    <tr>
                        <td>${item.title}</td>
                        <td><span style="padding: 4px 8px; background: ${item.priority === 'high' ? '#dc3545' : item.priority === 'medium' ? '#ffc107' : '#28a745'}; color: white; border-radius: 4px; font-size: 12px;">${item.priority}</span></td>
                        <td><span style="padding: 4px 8px; background: ${item.status === 'completed' ? '#28a745' : item.status === 'in_progress' ? '#ffc107' : '#6c757d'}; color: white; border-radius: 4px; font-size: 12px;">${item.status}</span></td>
                        <td>
                            <button class="action-btn edit-btn" onclick="editAgenda(${item.id})">Edit</button>
                            <button class="action-btn delete-btn" onclick="deleteAgenda(${item.id})">Delete</button>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                showAlert('agendaAlert', 'Error loading agenda items', 'error');
            }
        }
        
        async function loadDonations() {
            try {
                const response = await fetch(`${API_BASE}/api/admin/donations`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                const donations = await response.json();
                
                const tbody = document.getElementById('donationsTableBody');
                tbody.innerHTML = donations.map(donation => `
                    <tr>
                        <td>${donation.name}</td>
                        <td>${donation.email}</td>
                        <td>$${donation.amount}</td>
                        <td>${donation.payment_method}</td>
                        <td>${new Date(donation.created_at).toLocaleDateString()}</td>
                    </tr>
                `).join('');
            } catch (error) {
                showAlert('donationsAlert', 'Error loading donations', 'error');
            }
        }
        
        async function handleNewsSubmit(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const newsData = {
                title: formData.get('title'),
                content: formData.get('content'),
                author: formData.get('author'),
                category: formData.get('category')
            };
            
            try {
                const url = currentEditId ? `${API_BASE}/api/admin/news/${currentEditId}` : `${API_BASE}/api/admin/news`;
                const method = currentEditId ? 'PUT' : 'POST';
                
                const response = await fetch(url, {
                    method,
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify(newsData)
                });
                
                if (response.ok) {
                    closeModal('newsModal');
                    loadNews();
                    showAlert('newsAlert', `Article ${currentEditId ? 'updated' : 'created'} successfully!`, 'success');
                } else {
                    const error = await response.json();
                    showAlert('newsAlert', error.error || 'Operation failed', 'error');
                }
            } catch (error) {
                showAlert('newsAlert', 'Connection error', 'error');
            }
        }
        
        async function handleEventSubmit(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const eventData = {
                title: formData.get('title'),
                description: formData.get('description'),
                date: formData.get('date'),
                location: formData.get('location')
            };
            
            try {
                const url = currentEditId ? `${API_BASE}/api/admin/events/${currentEditId}` : `${API_BASE}/api/admin/events`;
                const method = currentEditId ? 'PUT' : 'POST';
                
                const response = await fetch(url, {
                    method,
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify(eventData)
                });
                
                if (response.ok) {
                    closeModal('eventModal');
                    loadEvents();
                    showAlert('eventsAlert', `Event ${currentEditId ? 'updated' : 'created'} successfully!`, 'success');
                } else {
                    const error = await response.json();
                    showAlert('eventsAlert', error.error || 'Operation failed', 'error');
                }
            } catch (error) {
                showAlert('eventsAlert', 'Connection error', 'error');
            }
        }
        
        async function handleAgendaSubmit(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const agendaData = {
                title: formData.get('title'),
                description: formData.get('description'),
                priority: formData.get('priority'),
                status: formData.get('status')
            };
            
            try {
                const url = currentEditId ? `${API_BASE}/api/admin/agenda/${currentEditId}` : `${API_BASE}/api/admin/agenda`;
                const method = currentEditId ? 'PUT' : 'POST';
                
                const response = await fetch(url, {
                    method,
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify(agendaData)
                });
                
                if (response.ok) {
                    closeModal('agendaModal');
                    loadAgenda();
                    showAlert('agendaAlert', `Agenda item ${currentEditId ? 'updated' : 'created'} successfully!`, 'success');
                } else {
                    const error = await response.json();
                    showAlert('agendaAlert', error.error || 'Operation failed', 'error');
                }
            } catch (error) {
                showAlert('agendaAlert', 'Connection error', 'error');
            }
        }
        
        async function editNews(id) {
            try {
                const response = await fetch(`${API_BASE}/api/admin/news/${id}`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                const article = await response.json();
                openModal('newsModal', article);
            } catch (error) {
                showAlert('newsAlert', 'Error loading article', 'error');
            }
        }
        
        async function deleteNews(id) {
            if (confirm('Are you sure you want to delete this article?')) {
                try {
                    const response = await fetch(`${API_BASE}/api/admin/news/${id}`, {
                        method: 'DELETE',
                        headers: { 'Authorization': `Bearer ${authToken}` }
                    });
                    
                    if (response.ok) {
                        loadNews();
                        showAlert('newsAlert', 'Article deleted successfully!', 'success');
                    } else {
                        showAlert('newsAlert', 'Error deleting article', 'error');
                    }
                } catch (error) {
                    showAlert('newsAlert', 'Connection error', 'error');
                }
            }
        }
        
        async function editEvent(id) {
            try {
                const response = await fetch(`${API_BASE}/api/admin/events/${id}`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                const event = await response.json();
                openModal('eventModal', event);
            } catch (error) {
                showAlert('eventsAlert', 'Error loading event', 'error');
            }
        }
        
        async function deleteEvent(id) {
            if (confirm('Are you sure you want to delete this event?')) {
                try {
                    const response = await fetch(`${API_BASE}/api/admin/events/${id}`, {
                        method: 'DELETE',
                        headers: { 'Authorization': `Bearer ${authToken}` }
                    });
                    
                    if (response.ok) {
                        loadEvents();
                        showAlert('eventsAlert', 'Event deleted successfully!', 'success');
                    } else {
                        showAlert('eventsAlert', 'Error deleting event', 'error');
                    }
                } catch (error) {
                    showAlert('eventsAlert', 'Connection error', 'error');
                }
            }
        }
        
        async function editAgenda(id) {
            try {
                const response = await fetch(`${API_BASE}/api/admin/agenda/${id}`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                const item = await response.json();
                openModal('agendaModal', item);
            } catch (error) {
                showAlert('agendaAlert', 'Error loading agenda item', 'error');
            }
        }
        
        async function deleteAgenda(id) {
            if (confirm('Are you sure you want to delete this agenda item?')) {
                try {
                    const response = await fetch(`${API_BASE}/api/admin/agenda/${id}`, {
                        method: 'DELETE',
                        headers: { 'Authorization': `Bearer ${authToken}` }
                    });
                    
                    if (response.ok) {
                        loadAgenda();
                        showAlert('agendaAlert', 'Agenda item deleted successfully!', 'success');
                    } else {
                        showAlert('agendaAlert', 'Error deleting agenda item', 'error');
                    }
                } catch (error) {
                    showAlert('agendaAlert', 'Connection error', 'error');
                }
            }
        }
        
        function showAlert(containerId, message, type) {
            const container = document.getElementById(containerId);
            container.innerHTML = `<div class="alert alert-${type === 'error' ? 'error' : 'success'}">${message}</div>`;
            setTimeout(() => {
                container.innerHTML = '';
            }, 5000);
        }
        
        function showError(elementId, message) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.style.display = 'block';
        }
        
        // Contact Messages Functions
        async function loadMessages() {
            try {
                const response = await fetch(`${API_BASE}/api/admin/contacts`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                const messages = await response.json();
                renderMessages(messages);
            } catch (error) {
                showAlert('messagesAlert', 'Error loading messages', 'error');
            }
        }
        
        function renderMessages(messages) {
            const tbody = document.querySelector('#messagesTable tbody');
            tbody.innerHTML = '';
            
            messages.forEach(message => {
                const row = document.createElement('tr');
                const statusClass = message.status === 'read' ? 'status-read' : 'status-unread';
                
                row.innerHTML = `
                    <td>${message.name}</td>
                    <td>${message.email}</td>
                    <td>${message.subject}</td>
                    <td>${new Date(message.submitted_at).toLocaleDateString()}</td>
                    <td><span class="${statusClass}">${message.status}</span></td>
                    <td>
                        <button class="action-btn" onclick="viewMessage(${message.id})">View</button>
                        <button class="reply-btn" onclick="replyToMessage(${message.id})">Reply</button>
                        <button class="delete-btn" onclick="deleteMessage(${message.id})">Delete</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        async function viewMessage(id) {
            try {
                const response = await fetch(`${API_BASE}/api/admin/contacts/${id}`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                const message = await response.json();
                
                document.getElementById('messageViewName').textContent = message.name;
                document.getElementById('messageViewEmail').textContent = message.email;
                document.getElementById('messageViewPhone').textContent = message.phone || 'N/A';
                document.getElementById('messageViewSubject').textContent = message.subject;
                document.getElementById('messageViewDate').textContent = new Date(message.submitted_at).toLocaleString();
                document.getElementById('messageViewContent').textContent = message.message;
                
                document.getElementById('messageViewModal').style.display = 'block';
                
                // Mark as read if not already
                if (message.status === 'new') {
                    markAsRead(id);
                }
            } catch (error) {
                showAlert('messagesAlert', 'Error loading message', 'error');
            }
        }
        
        async function markAsRead(id) {
            try {
                await fetch(`${API_BASE}/api/admin/contacts/${id}/read`, {
                    method: 'PUT',
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                loadMessages(); // Refresh the list
            } catch (error) {
                console.error('Error marking message as read:', error);
            }
        }
        
        function replyToMessage(id) {
            // Get message details for reply
            fetch(`${API_BASE}/api/admin/contacts/${id}`, {
                headers: { 'Authorization': `Bearer ${authToken}` }
            })
            .then(response => response.json())
            .then(message => {
                document.getElementById('replyTo').value = message.email;
                document.getElementById('replySubject').value = `Re: ${message.subject}`;
                document.getElementById('replyMessage').value = '';
                document.getElementById('replyModal').style.display = 'block';
            })
            .catch(error => {
                showAlert('messagesAlert', 'Error loading message for reply', 'error');
            });
        }
        
        async function deleteMessage(id) {
            if (confirm('Are you sure you want to delete this message?')) {
                try {
                    const response = await fetch(`${API_BASE}/api/admin/contacts/${id}`, {
                        method: 'DELETE',
                        headers: { 'Authorization': `Bearer ${authToken}` }
                    });
                    
                    if (response.ok) {
                        loadMessages();
                        showAlert('messagesAlert', 'Message deleted successfully!', 'success');
                    } else {
                        showAlert('messagesAlert', 'Error deleting message', 'error');
                    }
                } catch (error) {
                    showAlert('messagesAlert', 'Connection error', 'error');
                }
            }
        }
        
        // Reply form submission
        document.getElementById('replyForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = {
                to: document.getElementById('replyTo').value,
                subject: document.getElementById('replySubject').value,
                message: document.getElementById('replyMessage').value
            };
            
            try {
                const response = await fetch(`${API_BASE}/api/admin/reply`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify(formData)
                });
                
                if (response.ok) {
                    document.getElementById('replyModal').style.display = 'none';
                    document.getElementById('replyForm').reset();
                    showAlert('messagesAlert', 'Reply sent successfully!', 'success');
                } else {
                    showAlert('messagesAlert', 'Error sending reply', 'error');
                }
            } catch (error) {
                showAlert('messagesAlert', 'Connection error', 'error');
            }
        });
        
        // Close modals when clicking outside
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        }
    </script>
</body>
</html>